============================================================
EFD: ONSET OF DYNAMICS â€” STAGE 1 (v3.4)
RE-COHERENCE ORDER AND INTERNAL TIME
============================================================

## SCOPE
This document formalizes the emergence of internal time from the EFD
Foundations without introducing non-emergent primitives. All choices
(Îµ, neighborhoods, projection metrics, tie-breaks) are derived from the
coherence functional C, the substrate Î©, and the boundary âˆ‚M, or are
validated by Ï„-invariance on stability plateaus.

------------------------------------------------------------
0) PRELIMINARIES (Imported from Foundations)
------------------------------------------------------------
Î©  : substrate of admissible relations (discrete difference primitives).
M âŠ‚ Î© : coherent region (maximizer of a coherence functional C).
âˆ‚M : boundary (admissible but incompatible extensions = â€œnoiseâ€).
L  : feedback loop; M_â„“ : minimal closure of L (coherent).
C  : coherence functional, bounded above on finite subgraphs.

All updates are combinatorial on discrete structures. Finite local
alphabets (labels) per relation are assumed for computability; infinite
generalizations are handled via posets/limits (Sec. 10).

------------------------------------------------------------
1) COHERENCE CHANGE AND VIOLATIONS
------------------------------------------------------------
For a finite state X âŠ‚ M and local modification Ïƒ (atomic toggle/replace
of a finite set of relations in Î©), define:
  Î”C_X(Ïƒ) := C(ÏƒÂ·X) âˆ’ C(X).

Violation set at X:
  V(X) := { r âˆˆ X : âˆƒ local Ïƒ touching r with Î”C_X(Ïƒ) > 0 }.

(â€œBeforeâ€ = X, â€œafterâ€ = ÏƒÂ·X; no ambiguity.)

------------------------------------------------------------
2) NEIGHBORHOODS INDUCED BY C (no extra structure)
------------------------------------------------------------
Let C factor into local factors F_k over scopes S_k âŠ‚ M (factor graph).
Define the neighborhood of relation r_j as:
  N_j := â‹ƒ { S_k : r_j âˆˆ S_k }.
This is read off the sparsity of C (emergent).

------------------------------------------------------------
3) BEST-RESPONSE AND DISCRETE INFLUENCE (derived from C)
------------------------------------------------------------
ASSUMPTION (finite local alphabets).
Each relation r has a finite label set Î£_r. (Continuous cases use
quantization/refinement; see Sec. 10.)

BEST-RESPONSE (local, C-maximizing; emergent tie-break).
Given state X and perturbation Ïƒ on r_i, define
  BR_X(r_j | Ïƒ) := argmax_{a âˆˆ Î£_{r_j}} C( X with r_j := a, Ïƒ applied ),
with tie-break by lexicographic minimality of:
  (i) atomic edit count relative to X; (ii) |Î”C| magnitude.
(No external ordering introduced.)

DISCRETE INFLUENCE (no derivatives).
For relations r_i, r_j:
  I_X(r_j | r_i) := max_{Ïƒ toggles r_i over Î£_{r_i}}
                    | C( Xâ€² with r_j := BR_X(r_j | Ïƒ) )
                    âˆ’ C( X  with r_j := BR_X(r_j | id) ) |,
where Xâ€² := ÏƒÂ·X, and â€œidâ€ = no change at r_i.

For loop-closures M_â„“áµ¢, M_â„“â±¼:
  I_X(M_â„“â±¼ | M_â„“áµ¢) := max_{r_iâˆˆM_â„“áµ¢, r_jâˆˆM_â„“â±¼} I_X(r_j | r_i).

------------------------------------------------------------
4) INFLUENCE THRESHOLD Îµ* (emergent, boundary-calibrated)
------------------------------------------------------------
Boundary perturbation at X via projection Î  (Sec. 8) yields
  Î´C_X(r) := C(Î (r)Â·X) âˆ’ C(X),  r âˆˆ âˆ‚M.
Define boundary scale Ïƒ_âˆ‚ := median( |Î´C_X(r)| ) over a boundary batch.

For Îµ varying, build G_X(Îµ) (Sec. 6) and define Ï„(Îµ) as the height of
its condensation DAG. A value Îµ lies on a Ï„-stability plateau if Ï„(Îµ)
remains constant under Îµ-small changes and boundary perturbations up to
scale Ïƒ_âˆ‚.

EMERGENT SELECTION (no Îº):
  Îµ* := the smallest Îµ that maximizes the width of the Ï„-stability
        plateau under boundary-scale perturbations Ïƒ_âˆ‚.

(Least edges among maximizers â†’ least added structure.)

STRUCTURAL STABILITY LEMMA.
On any Îµ-interval where edges of G_X(Îµ) do not change, SCCs, Gâ€², and Ï„
are invariant.

------------------------------------------------------------
5) RE-COHERENCE OPERATOR ON A LATTICE (Tarski default)
------------------------------------------------------------
Let ğ’Ÿ be the product lattice of local assignments on M (finite Î£_r).
Define R : ğ’Ÿ â†’ ğ’Ÿ monotone and inflationary (X â‰¤ R(X)), implementing
local best-responses that do not decrease C.

TARSKIâ€“KNASTER.
On a complete lattice, monotone R has least/greatest fixed points.
Ascending iteration from âŠ¥ reaches the least fixed point in finitely
many steps on finite SCC state spaces.

LEMMA (SCC convergence).
For an SCC S, iterating R_S from âŠ¥ yields a fixed point X_S^* in finitely
many steps (no metric/contractivity assumed).

(OPTIONAL IMPLEMENTATION ONLY: Î±-averaged/damped updates give rates in
Hamming/â„“â‚; not used in theorems.)

------------------------------------------------------------
6) G, SCCs, CONDENSATION, ORDER (all standard)
------------------------------------------------------------
Construct directed influence graph at X:
  V = { M_â„“ },   E_Îµ = { M_â„“áµ¢ â†’ M_â„“â±¼ : I_X(M_â„“â±¼ | M_â„“áµ¢) > Îµ }.
Let G_X(Îµ) = (V, E_Îµ).

Compute SCCs by Kosaraju to partition V into {Sâ‚,â€¦,S_K}.
Contract SCCs to nodes â†’ condensation graph Gâ€²_X(Îµ), a DAG.
Define partial order A < B if there is a path A â†’ â€¦ â†’ B.

------------------------------------------------------------
7) EMERGENT TIME Ï„ (height; parallel-aware)
------------------------------------------------------------
Time at X for threshold Îµ is:
  Ï„(Îµ) := height( Gâ€²_X(Îµ) ) = max length of chains Aâ‚ < â€¦ < A_n.
This is minimal sequential depth with parallel updates within each DAG
level. Ï„ is a DAG isomorphism invariant; by structural stability it is
constant on Îµ-plateaus.

Define **system time** as Ï„* := Ï„(Îµ*).

------------------------------------------------------------
8) NOISE PROJECTION Î  FROM âˆ‚M (induced by C; no external metric)
------------------------------------------------------------
Let D_C be a (discrete) Bregman divergence induced by C
(using convex envelope/subgradient in discrete labels). Define
  Î (r) := argmin_{sâˆˆM} D_C(r, s).

Boundary perturbation:
  Î´C_X(r) := C( Î (r)Â·X ) âˆ’ C(X).

BOUNDARY PERSISTENCE (emergent assumptions).

â€¢ Deterministic genericity (optional):
  If M is maximal under C and Î© admits admissible extensions, then for
  any finite ball B âŠ‚ M there exist r âˆˆ âˆ‚M whose Î (r) affects B:
  |Î´C_X(r)| â‰¥ Î·_B > 0 â†’ re-coherence restarts in B.

â€¢ Probabilistic (default):
  A stationary ergodic boundary source on âˆ‚M with nonzero D_C-mass in
  every admissible neighborhood yields infinitely many nontrivial Î´C
  almost surely (Borelâ€“Cantelli) â†’ perpetual re-coherence without an
  external clock.

------------------------------------------------------------
9) THEOREMS AND COROLLARIES
------------------------------------------------------------
THEOREM 1 (Blockwise fixed points).
For each SCC S, monotone R_S on its finite lattice admits a least fixed
point X_S^*, obtained by ascending iteration.

THEOREM 2 (Emergent causal order and time).
With Îµ*, the condensation graph Gâ€²_X(Îµ*) is a DAG; its height Ï„* is an
isomorphism invariant and is constant across the Îµ*-plateau. Blocks at
the same level commute (no precedence), so updates are maximally
parallel subject to dependencies.

COROLLARY (Parallelism).
If A and B are incomparable in Gâ€², R_A âˆ˜ R_B = R_B âˆ˜ R_A.

------------------------------------------------------------
10) INFINITE / LOCALLY FINITE / ORDINAL TIME
------------------------------------------------------------
PROGRESS MEASURE (well-foundedness).
Each accepted update strictly increases a well-founded measure, e.g.,
lexicographic ( #violations decreasing, âˆ’âˆ‘Î”C increasing ), preventing
infinite descending chains.

ORDINAL RANK.
If Gâ€² is well-founded and possibly infinite, define node rank by
transfinite recursion:
  Ï(v) = sup{ Ï(u) + 1 : u â†’ v }.
Local time at v is Ï„_v := Ï(v) (countable ordinal in locally finite
cases). Finite observer horizons use Ï„_R (restriction to R-neighborhoods).

CONTINUUM LIMIT.
Under refinement where |Î”C| â†’ 0 and Ï„_R scales like R/Î”t_min, a
continuous parameter t emerges (carried to Stage 2).

------------------------------------------------------------
11) TOY EXAMPLE (explicit Ï„ shift)
------------------------------------------------------------
Influences: I(B|A)=3, I(C|B)=3, I(A|C)=3, I(D|A)=0.2; othersâ‰ˆ0.

Case 1: Îµ âˆˆ (0.2, 3).
Edges: Aâ†’B, Bâ†’C, Câ†’A; D isolated.
SCCs: S1={A,B,C}, S2={D}.  Gâ€² has two nodes with no edge.  Ï„=1.

Case 2: Îµ just below 0.2.
Add edge Aâ†’D (one-way).  SCCs unchanged.  Gâ€²: S1 â†’ S2.  Ï„=2.

Îµ* selection picks the smallest Îµ maximizing plateau width under Ïƒ_âˆ‚.
If the (0.2,3) plateau is wider than (~0,0.2), Îµ* lies in (0.2,3),
hence Ï„* = 1.

------------------------------------------------------------
12) PSEUDOCODE (influence â†’ SCCs â†’ Ï„*, Ï„-preserving check)
------------------------------------------------------------
INPUT: closures {Mâ„“}, state X
1:  Estimate boundary scale Ïƒ_âˆ‚ from a batch of Î (âˆ‚M) at X
2:  Sweep Îµ; for each Îµ:
3:     Build E_Îµ with I_X approximated by local enumeration/sampling
4:     SCCs â† Kosaraju(E_Îµ); Gâ€² â† Condensation(SCCs, E_Îµ)
5:     Ï„(Îµ) â† DAGHeight(Gâ€²)
6:  Select Îµ* as smallest Îµ maximizing Ï„-plateau width under Ïƒ_âˆ‚
7:  (Optional) Refine I_X until Ï„(Îµ*) stabilizes  â†’ Ï„-preserving acceptance
8:  Return Ï„* = Ï„(Îµ*), Gâ€²(Îµ*), SCC layering, block fixed points X_S^*

(Approximate influence is acceptable iff Ï„(Îµ*) remains unchanged under
additional samples; no extra knob.)

------------------------------------------------------------
13) REFERENCES (pinpoint)
------------------------------------------------------------
Harary, F. (1969). Graph Theory, Â§9.2 (DAG height invariants).
Kahn, A. (1962). Topological sorting of large networks.
Kosaraju, S. (1978). Linear-time SCC decomposition.
Tarski, A. (1955). A lattice-theoretic fixpoint theorem.
Pearl, J. (2009). Causality, Ch. 2 (influence/causal graphs).
Opial (1967); Krasnoselâ€™skiiâ€“Mann (1955â€“63): averaged/nonexpansive maps.

============================================================
End of Stage 1 (v3.4)
============================================================
