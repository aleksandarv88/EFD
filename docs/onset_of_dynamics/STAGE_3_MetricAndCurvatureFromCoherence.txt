============================================================
EFD: ONSET OF DYNAMICS ‚Äî STAGE 3 (v3.1)
METRIC & CURVATURE FROM COHERENCE
============================================================

## PURPOSE
Build geometry (distance, geodesics, curvature) purely from Stage 1‚Äì2
primitives. No external metric, units, or calculus are introduced. All
constructs derive from the coherence functional C, the Œµ*‚Äìstable influence
structure, and re-coherence semantics (R with least fixed points).

------------------------------------------------------------
0) IMPORTS (Stage 1 v3.4, Stage 2 v3.3)
------------------------------------------------------------
‚Ä¢ Œµ* : smallest maximizer of the œÑ-plateau width at boundary scale œÉ_‚àÇ.
‚Ä¢ Influence graph at state X: G_X(Œµ*) = (V,E) on loop-closures {M_‚Ñì}.
‚Ä¢ Symmetric influence I_X(M_‚Ñìj | M_‚Ñìi) (Stage 1 best-response influence).
‚Ä¢ Dynamic/robust notions (Stage 2): G_{k,t}, E^‚òÖ, E^‚ãÉ, time-respecting paths.
‚Ä¢ Rank œÅ, height œÑ, level-synchronous scheduling (Stage 2).

All geometry here is a **snapshot** at a fixed state X; time-dependence is
handled by re-evaluating at updated states X‚Ä≤ after re-coherence.

============================================================
1) METRIC SUPPORT GRAPH (UNDIRECTED) FROM INFLUENCE
============================================================
Definition 1.1 (Metric support U_X).
U_X has vertex set V and undirected edge {i,j} iff
  J_{ij}(X) := max{ I_X(M_‚Ñìj | M_‚Ñìi), I_X(M_‚Ñìi | M_‚Ñìj) } > Œµ*.
Edges will carry symmetric nonnegative weights w_{ij}(X) (Sec. 2).

Remarks:
‚Ä¢ U_X captures **mutual** responsiveness from C via the same influence used
  in Stages 1‚Äì2 (no new primitive).
‚Ä¢ Geometry is per connected component of U_X (‚àû distance across components).

============================================================
2) EDGE WEIGHTS FROM INFLUENCE (Œµ*-EMERGENT)
============================================================
Definition 2.1 (Œµ*-normalized effective weight).
For {i,j}‚ààE(U_X), set
  w_{ij}(X) := Œµ* / J_{ij}(X)  ‚àà (0,1],
and w_{ij} := +‚àû if {i,j}‚àâE(U_X).

Properties:
‚Ä¢ Symmetry: w_{ij}=w_{ji}.  Positivity: w_{ij}>0 on edges.  w_{ii}=0.
‚Ä¢ Emergence: depends only on (C, Œµ*, X) via Stage-1 influence.

Intuition: larger mutual influence ‚áí smaller traversal cost; Œµ* provides
intrinsic normalization‚Äîno extra scales.

============================================================
3) PATH METRIC AND GEODESICS
============================================================
Definition 3.1 (Path cost and distance).
For any path Œ≥=(v_0,‚Ä¶,v_k), define L_X(Œ≥):=Œ£ w_{v_m v_{m+1}}(X).
The distance d_X(i,j):=inf_{Œ≥:i‚Üíj in U_X} L_X(Œ≥), with d_X=+‚àû if disconnected.

Theorem 3.2 (Metric axioms on each component).
On any connected component of U_X, d_X satisfies nonnegativity/identity,
symmetry, and the triangle inequality.  (Standard shortest-path metric.)

Corollary 3.3 (Bi-Lipschitz with hop distance under bounded influence).
Let Œµ*<Œπ_min ‚â§ J_{ij}(X) ‚â§ Œπ_max<‚àû on the component. Then
  (Œµ*/Œπ_max)¬∑Hop_X(i,j) ‚â§ d_X(i,j) ‚â§ (Œµ*/Œπ_min)¬∑Hop_X(i,j).
**Regularity regime.** This assumption only relates d_X to hop distance.
Outside it, d_X remains a valid metric; the comparison may fail.

============================================================
4) PARALLEL TRANSPORT AND DISCRETE HOLONOMY (FROM R)
============================================================
Setup 4.0 (Local variation space).
At block i, let ùíú_i be the finite set of admissible **atomic edits** (Stage 1)
supported in M_‚Ñìi. For œÉ‚ààùíú_i, write ŒîC_i(œÉ) for coherence change at i
(others fixed unless induced by R).

Definition 4.1 (One-step transport along an edge).
Fix an orientation i‚Üíj for {i,j} (e.g., direct from larger influence:
I_X(j|i) ‚â• I_X(i|j)). Given œÉ‚ààùíú_i:
  X‚Ä≤ := R_i(œÉ¬∑X)  (least fixed point at i),
  T_{i‚Üíj}(œÉ) := argmax_{œÑ‚ààùíú_j} C( R_j(œÑ¬∑X‚Ä≤) )
with Stage-1 emergent tie-break (minimal edits, then minimal |ŒîC|).
If {i,j}‚àâE(U_X), T_{i‚Üíj} undefined.
**Orientation note.** Reversing all edge orientations conjugates transports;
the **holonomy magnitude** below is unchanged (Sec. 4.4(b)).

Definition 4.2 (Path transport and holonomy).
For Œ≥: v_0‚Üí‚Ä¶‚Üív_k, set T_Œ≥ := T_{v_{k-1}‚Üív_k}‚àò‚Ä¶‚àòT_{v_0‚Üív_1}.
For a loop Œ≥ based at i, H_Œ≥ := T_Œ≥ : ùíú_i‚Üíùíú_i.

Definition 4.3 (Holonomy magnitude via C).
For œÉ‚ààùíú_i with |ŒîC_i(œÉ)|>0, define h_Œ≥(œÉ):=
  |ŒîC_i( H_Œ≥(œÉ) ) ‚àí ŒîC_i(œÉ)|.
Set  ‚Ñã_X(Œ≥):= sup_{œÉ‚ààùíú_i, |ŒîC_i(œÉ)|>0} h_Œ≥(œÉ)/|ŒîC_i(œÉ)|.
**Boundedness note.** ùíú_i is finite (Stage-1 finite labels). Under refinements,
use a finite generating set; the sup can be approximated monotonically.

Theorem 4.4 (Holonomy properties).
(a) Identity loop ‚áí ‚Ñã_X=0.  (b) Basepoint/orientation changes act by
conjugation ‚áí ‚Ñã_X invariant. (c) Concatenation: ‚Ñã_X(Œ≥1‚àòŒ≥2) ‚â§ f(‚Ñã_X(Œ≥1),‚Ñã_X(Œ≥2))
with f(a,b) ‚â§ a+b for small a,b (subadditive up to higher orders). (d) If the
underlying U_X is a tree in the region, all contractible loops have ‚Ñã_X=0.

============================================================
5) DISCRETE CURVATURE: TWO EMERGENT OPTIONS
============================================================

(A) Holonomy-based loop curvature (canonical 2-complex)
-------------------------------------------------------
**Canonical 2-complex (no choice).** Let Flag(U_X) be the **clique/flag complex**
of U_X: every (k+1)-clique spans a k-simplex. This complex is uniquely determined
by U_X (itself from C and Œµ*).

**Combinatorial area.** For a loop Œ≥ in the 1-skeleton of U_X, define
  area_X(Œ≥) := min # { 2-simplices in Flag(U_X) }
over 2-chains whose boundary is Œ≥.

**Weighted variant (still emergent).** For a face f={i,j,k}, set
  a_f := (w_{ij}+w_{jk}+w_{ki})/3, and let area_X(Œ≥) be the minimum total a_f
over fillings. (Uses only w from C,Œµ*.)

Definition 5.1 (Local loop curvature at i).
Let ùíÆ_i be simple loops through i in the 1-skeleton. Define
  K_hol(i) := limsup_{Œ≥‚ààùíÆ_i, area_X(Œ≥)‚Üí0}  ‚Ñã_X(Œ≥) / area_X(Œ≥).

Lemma 5.2 (Invariance & plateau stability).
Flag(U_X) and area_X are graph-isomorphism invariants; on the Œµ* œÑ-plateau,
U_X (hence Flag(U_X), area_X) are stable ‚áí K_hol is observer-invariant and
plateau-stable.

(B) Ollivier‚ÄìRicci curvature from influence-weighted measures
-------------------------------------------------------------
Definition 5.3 (Neighbor measures).
For each i, define Œº_i on N(i) by
  Œº_i(j) := J_{ij}(X) / Œ£_{k‚ààN(i)} J_{ik}(X).
Let W_1(Œº_i,Œº_j; d_X) be the 1-Wasserstein distance w.r.t. d_X.

Definition 5.4 (Edge curvature).
  Œ∫(i,j) := 1 ‚àí W_1(Œº_i, Œº_j; d_X) / w_{ij}.

Theorem 5.5 (Basic properties).
(a) Isomorphism-invariance for Œ∫ and K_hol. (b) Œµ*-plateau stability for Œ∫ and d_X.
(c) Usual regimes: tree-like ‚áí Œ∫‚âà0; expander-like ‚áí Œ∫>0; divergent neighborhoods ‚áí Œ∫<0.

============================================================
6) RELATIONS BETWEEN d_X, HOP, AND CURVATURE
============================================================
Proposition 6.1 (Coarse equivalence under regularity).
Under the bounded-influence regime of Cor. 3.3, d_X is bi-Lipschitz to Hop,
so neighborhood transport costs and W_1 are comparable; small-loop holonomy
agrees in sign with discrete Ricci under mild regularity.

============================================================
7) EMERGENCE & INVARIANCE CHECK
============================================================
‚Ä¢ No new primitives: U_X, w_{ij}, d_X, T, ‚Ñã, Œ∫ arise from C, Œµ*, I_X, and R.
‚Ä¢ Observer invariance: Isomorphisms preserve I_X ‚áí U_X, weights, d_X, Œ∫, K_hol.
‚Ä¢ Plateau stability: Œµ=Œµ* on a œÑ-plateau ‚áí U_X, w_{ij}, d_X, Œ∫, Flag(U_X), area_X stable.

============================================================
8) EXAMPLES (ASCII)
============================================================
(1) Weighted chain (uniform influence)
  i‚Äîj‚Äîk‚Äîl with J=J0 on edges ‚áí w=Œµ*/J0.
  d_X(i,l)=3¬∑(Œµ*/J0). Tree ‚áí ‚Ñã_X=0; Œ∫‚âà0 except at ends.

(2) 2D lattice patch with a ‚Äúdefect‚Äù
  A grid where one edge has smaller J ‚áí larger w ‚áí geodesics bend around it.
  Small loops encircling the defect have ‚Ñã_X>0; Œ∫ positive near the defect.

(3) Triangle vs path
  Triangle i‚Äîj‚Äîk‚Äîi (equal J) ‚áí positive Œ∫ and nontrivial holonomy.
  Path i‚Äîj‚Äîk‚Äîl ‚áí Œ∫‚âà0; holonomy zero (no cycles).

============================================================
9) PSEUDOCODE (weights, distances, curvature)
============================================================
# Build U_X and weights (emergent from C, Œµ*)
for each unordered pair {i,j}:
    J_ij = max( I_X(j|i), I_X(i|j) )
    if J_ij > Œµ*:
        w_ij = Œµ* / J_ij
        add undirected edge {i,j} with weight w_ij

# Distances (run Dijkstra per component)
for each source i:
    d_X[i,¬∑] = Dijkstra(U_X, weights)

# Influence-weighted neighbor measures for Ollivier
for each i:
    Z = sum_{k in N(i)} J_ik
    Œº_i(k) = J_ik / Z

# Edge curvature Œ∫(i,j)
for each edge {i,j}:
    Œ∫(i,j) = 1 - Wasserstein1(Œº_i, Œº_j; ground = d_X) / w_ij

# Holonomy magnitude on a local cycle basis
for each simple cycle Œ≥ through i:
    compute ‚Ñã_X(Œ≥) by transporting atomic edits via T along Œ≥
    (use a finite generating set of ùíú_i; monotone sup approximation)

Notes:
‚Ä¢ W_1 can be computed with standard Earth-Mover/Hungarian solvers on small neighborhoods.
‚Ä¢ For large graphs, recompute influence sparsely around blocks changed during Stage-2 dynamics.

============================================================
10) RESULTS
============================================================
‚Ä¢ A **distance** d_X is defined purely from (C, Œµ*, influence); metric axioms hold.
‚Ä¢ d_X and the Stage-2 hop structure are tightly related under a clear regularity regime.
‚Ä¢ Two **curvature** notions emerge:
  ‚Äì K_hol from transport-induced holonomy on Flag(U_X) (canonical, no choice),
  ‚Äì Œ∫ from influence-weighted neighbor transport (Ollivier‚ÄìRicci).
‚Ä¢ Observer invariance and Œµ*-plateau stability hold for all constructs.

============================================================
11) FORESHADOW (to Stage 5)
============================================================
Under refinement (mesh‚Üí0, |ŒîC|‚Üí0), target theorems:
  (i) Œì-convergence of discrete path energies to a length metric with field g_{ij},
  (ii) convergence of holonomy/Œ∫ to Riemannian curvature tensors,
  (iii) scaling of œÑ to a continuous time parameter t (from Stage 2).

============================================================
End of Stage 3 (v3.1)
============================================================
